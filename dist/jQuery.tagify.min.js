!function(t){function e(t,e){if(!t)return console.warn("Tagify: ","invalid input element ",t),this;if(e.hasOwnProperty("enforeWhitelist")&&!e.hasOwnProperty("enforceWhitelist")&&(e.enforceWhitelist=e.enforeWhitelist,console.warn("Please update your Tagify settings. The 'enforeWhitelist' property is deprecated and you should be using 'enforceWhitelist'."),delete e.enforeWhitelist),this.settings=this.extend({},e,this.DEFAULTS),this.settings.readonly=t.hasAttribute("readonly"),t.pattern)try{this.settings.pattern=new RegExp(t.pattern)}catch(t){}if(e&&e.delimiters)try{this.settings.delimiters=new RegExp("["+e.delimiters+"]")}catch(t){}this.version="1.2.1",this.id=Math.random().toString(36).substr(2,9),this.value=[],this.DOM={},this.extend(this,new this.EventDispatcher),this.build(t),this.events()}t.fn.tagify=function(t){var i;return this.data("tagify")?this:((i=new e(this[0],t)).isJQueryPlugin=!0,this.data("tagify",i),this)},e.prototype={DEFAULTS:{delimiters:",",pattern:"",callbacks:{},duplicates:!1,enforceWhitelist:!1,autocomplete:!0,whitelist:[],blacklist:[],maxTags:1/0,suggestionsMinChars:2},build:function(t){var e=t.value,i='<div><input list="tagifySuggestions'+this.id+'" class="placeholder"/><span>'+t.placeholder+"</span></div>";this.DOM.originalInput=t,this.DOM.scope=document.createElement("tags"),this.DOM.scope.innerHTML=i,this.DOM.input=this.DOM.scope.querySelector("input"),this.settings.readonly&&this.DOM.scope.classList.add("readonly"),t.parentNode.insertBefore(this.DOM.scope,t),this.DOM.scope.appendChild(t),this.settings.autocomplete&&this.settings.whitelist.length&&(this.DOM.datalist=this.buildDataList()),e&&this.addTag(e).forEach(function(t){t&&t.classList.add("tagify--noAnim")})},destroy:function(){this.DOM.scope.parentNode.appendChild(this.DOM.originalInput),this.DOM.scope.parentNode.removeChild(this.DOM.scope)},extend:function(t,e,i){function n(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}return t instanceof Object||(t={}),i?(n(t,i),n(t,e)):n(t,e),t},EventDispatcher:function(){var e=document.createTextNode("");this.off=e.removeEventListener.bind(e),this.on=e.addEventListener.bind(e),this.trigger=function(i,n){var s;if(i)if(this.isJQueryPlugin)t(this.DOM.originalInput).triggerHandler(i,[n]);else{try{s=new CustomEvent(i,{detail:n})}catch(t){(s=document.createEvent("Event")).initEvent("toggle",!1,!1)}e.dispatchEvent(s)}}},events:function(){var e=this,i={paste:["onPaste","input"],focus:["onFocusBlur","input"],blur:["onFocusBlur","input"],input:["onInput","input"],keydown:["onKeydown","input"],click:["onClickScope","scope"]};for(var n in i)this.DOM[i[n][1]].addEventListener(n,this.callbacks[i[n][0]].bind(this));["add","remove","duplicate","maxTagsExceed","blacklisted","notWhitelisted"].forEach(function(t){e.on(t,e.settings.callbacks[t])}),this.isJQueryPlugin&&t(this.DOM.originalInput).on("tagify.removeAllTags",this.removeAllTags.bind(this))},callbacks:{onFocusBlur:function(t){var e=t.target.value.trim();"focus"==t.type?t.target.className="input":"blur"==t.type&&e?this.addTag(e).length&&(t.target.value=""):(t.target.className="input placeholder",this.DOM.input.removeAttribute("style"))},onKeydown:function(t){var e=t.target.value,i=this;if("Backspace"!=t.key||""!=e&&8203!=e.charCodeAt(0)||this.removeTag(this.DOM.scope.querySelectorAll("tag:not(.tagify--hide)").length-1),"Escape"==t.key&&(t.target.value="",t.target.blur()),"Enter"==t.key)return t.preventDefault(),this.addTag(e).length&&(t.target.value=""),!1;this.noneDatalistInput&&clearTimeout(this.noneDatalistInput),this.noneDatalistInput=setTimeout(function(){i.noneDatalistInput=null},50)},onInput:function(t){var e,i=t.target.value,n=(i[i.length-1],!this.noneDatalistInput&&i.length>1),s=i.length>=this.settings.suggestionsMinChars;t.target.style.width=7*(t.target.value.length+1)+"px",-1!=i.slice().search(this.settings.delimiters)||n?this.addTag(i).length&&(t.target.value=""):this.settings.autocomplete&&this.settings.whitelist.length&&(e=this.DOM.input.parentNode.contains(this.DOM.datalist),!s&&e?this.DOM.input.parentNode.removeChild(this.DOM.datalist):s&&!e&&this.DOM.input.parentNode.appendChild(this.DOM.datalist))},onPaste:function(t){var e=this;this.noneDatalistInput&&clearTimeout(this.noneDatalistInput),this.noneDatalistInput=setTimeout(function(){e.noneDatalistInput=null},50)},onClickScope:function(t){"TAGS"==t.target.tagName&&this.DOM.input.focus(),"X"==t.target.tagName&&this.removeTag(this.getNodeIndex(t.target.parentNode))}},buildDataList:function(){var t,e="",i=document.createElement("datalist");for(i.id="tagifySuggestions"+this.id,i.innerHTML="<label>                                 select from the list:                                 <select>                                     <option value=''></option>                                     [OPTIONS]                                 </select>                             </label>",t=this.settings.whitelist.length;t--;)e+="<option>"+this.settings.whitelist[t]+"</option>";return i.innerHTML=i.innerHTML.replace("[OPTIONS]",e),i},getNodeIndex:function(t){for(var e=0;t=t.previousSibling;)3==t.nodeType&&/^\s*$/.test(t.data)||e++;return e},markTagByValue:function(t){var e=this.value.filter(function(e){return t.toLowerCase()===e.toLowerCase()})[0],i=this.DOM.scope.querySelectorAll("tag")[e];return!!i&&(i.classList.add("tagify--mark"),setTimeout(function(){i.classList.remove("tagify--mark")},2e3),!0)},isTagBlacklisted:function(t){return t=t.split(" "),this.settings.blacklist.filter(function(e){return-1!=t.indexOf(e)}).length},isTagWhitelisted:function(t){return-1!=this.settings.whitelist.indexOf(t)},addTag:function(t){var e=this;return this.DOM.input.removeAttribute("style"),(t=t.trim())?t.split(this.settings.delimiters).filter(function(t){return!!t}).map(function(t){if(t=t.trim(),e.settings.pattern&&!e.settings.pattern.test(t))return!1;var i,n,s=document.createElement("tag"),a=e.markTagByValue(t),r=e.value.length>=e.settings.maxTags;return!(a&&(e.trigger("duplicate",t),!e.settings.duplicates))&&((i=!e.isTagBlacklisted(t)&&(!e.settings.enforceWhitelist||e.isTagWhitelisted(t))&&!r)||(s.classList.add("tagify--notAllowed"),setTimeout(function(){e.removeTag(e.getNodeIndex(s),!0)},1e3),r?n="maxTagsExceed":e.isTagBlacklisted(t)?n="blacklisted":e.settings.enforceWhitelist&&!e.isTagWhitelisted(t)&&(n="notWhitelisted"),e.trigger(n,{value:t,index:e.value.length})),s.innerHTML="<x></x><div><span title='"+t+"'>"+t+" </span></div>",e.DOM.scope.insertBefore(s,e.DOM.input.parentNode),i&&(e.value.push(t),e.update(),e.trigger("add",{value:t,index:e.value.length})),s)}).filter(function(t){return t}):[]},removeTag:function(t,e){var i=this.DOM.scope.children[t];i&&(i.style.width=parseFloat(window.getComputedStyle(i).width)+"px",document.body.clientTop,i.classList.add("tagify--hide"),setTimeout(function(){i.parentNode.removeChild(i)},400),e||(this.value.splice(t,1),this.update(),this.trigger("remove",{value:i.textContent.trim(),index:t})))},removeAllTags:function(){this.value=[],this.update(),Array.prototype.slice.call(this.DOM.scope.querySelectorAll("tag")).forEach(function(t){t.parentNode.removeChild(t)})},update:function(){this.DOM.originalInput.value=this.value.join(",")}}}(jQuery);